# lmapp Instructions

## ğŸ—ï¸ Project Overview
**lmapp** is a universal AI assistant - "AI Everywhere for Everyone"
- **Vision**: Offline-first AI accessible to everyone (grandparents to developers)
- **Stack**: Python, Ollama/llamafile, FastAPI, RAG, Workflows, Plugins
- **Key Features**: Chat, file access, RAG system, workflow engine, agent mode
- **Version**: v0.3.5 (Phase 1 Complete) | v0.3.2 (Production Release)
- **Status**: Phase 1 complete (dev foundation), Phase 2 planning (consumer layer)

## AI Model Configuration
See `~/.github/copilot-instructions.md` for global model configuration and strategies.

## ğŸ¯ Current Phase Status

### Phase 1: COMPLETE âœ… (Dev Foundation)
**Status:** Production-ready (v0.3.2 released, v0.3.5 development)

**Core Features Complete:**
- âœ… CLI interface (pip install lmapp && lmapp chat)
- âœ… Chat with local LLMs (Ollama, llamafile)
- âœ… File/folder access (read, search, analyze)
- âœ… RAG system (2,500 LOC) - ESSENTIAL for vision
- âœ… Workflow engine (1,800 LOC) - ESSENTIAL for vision
- âœ… Agent mode (autonomous actions)
- âœ… Plugin system (extensibility)
- âœ… FastAPI backend (API server)
- âœ… Performance optimizations (async, caching)
- âœ… Comprehensive testing (115+ tests, 85%+ coverage)
- âœ… CI/CD (GitHub Actions, PyPI publishing)

**Architecture:** 19,121 LOC (appropriate for "AI everywhere" scope)
**Assessment:** ğŸŸ¢ CORRECT DIRECTION - Foundation complete, ready for consumer layer

### Phase 2: IN PROGRESS ğŸš§ (Consumer Layer)
**Timeline:** Q1-Q2 2026
**Goal:** Make lmapp accessible to non-technical users

**2A: GUI/Desktop App** (Priority 1, Q1 2026)
- **Status:** ğŸš§ IN PROGRESS (Packaging)
- **Progress:** Scaffold âœ…, Backend âœ…, UI âœ…, Tests âœ…, Packaging âœ… (Linux)
- **Next:** Manual testing on all platforms
- Desktop application (like Cursor, Claude Desktop)
- Download â†’ Start â†’ Chat (< 3 clicks)
- CLI still accessible for power users
- Technologies: Electron, Tauri, or PyQt

**2B: Preset Workflows** (Priority 2, Q1-Q2 2026)
- Templates: Write paper, search files, game help, email automation
- One-click activation from GUI
- Shareable across community

**2C: Web App Interface** (Priority 3, Q2 2026)
- Browser-based access (no install)
- Works on any device

**2D: Installers** (Priority 4, Q2 2026)
- Windows .exe, macOS .dmg, Linux .deb/.rpm

### Phase 3: FUTURE ğŸ”œ (Enterprise & Ecosystem)
**Timeline:** Q3-Q4 2026

- VS Code extension (NOW APPROPRIATE - after consumer layer)
- Plugin marketplace
- Workflow template library
- Enterprise features (team collaboration, SSO)

---

## ğŸš€ Critical Workflows

### 1. Installation & Usage
```bash
# Install
pip install lmapp

# Run Chat
lmapp chat

# Run Agent Mode
lmapp chat --agent

# Start API server
lmapp serve  # Exposes /v1/refactor/* endpoints
```

### 2. Development & Testing
```bash
# Run all tests
pytest

# Run specific phase tests
pytest tests/test_e2e_refactoring.py          # 18 integration tests
pytest tests/test_performance_benchmark.py    # 14 performance tests
pytest tests/test_uat_scenarios.py            # 9 UAT tests

# Check status
lmapp status

# Run linting & checks
black src/
flake8 src/
mypy src/
```

### 3. Release Process
```bash
# 1. Bump version in src/lmapp/__init__.py
# 2. Update CHANGELOG.md
# 3. Create and push git tag
git tag -a vX.Y.Z -m "Release notes"
git push origin vX.Y.Z

# 4. GitHub Actions automatically:
#    - Runs all tests
#    - Builds distribution
#    - Publishes to PyPI
#    - Creates GitHub release
```

## ğŸ§© Project Vision & Architecture

**Mission:** "AI Everywhere for Everyone"
- **Philosophy:** Offline-first, online optional. User controls their data.
- **Target Audience:** Dual strategy - Devs now (build foundation) â†’ Everyone later (mass market)
- **Core Principle:** Both audiences side-by-side (not either/or)

**"Barebones" Definition:**
- NOT minimal features
- BUT all features easy to use for everyone
- Curve: Beginner â†’ Expert (grandparent to super dev god)
- Offline-first, online optional

**All Features in Core (NOT Optional):**
- Chat + file access + RAG + workflows + agent + plugins
- These are ESSENTIAL for "AI everywhere" vision
- Nothing is bloat - all support the mission

**Use Cases:**
1. Road-tripper: No cell service, ask AI a question
2. Gamer: Get codes/tips without searching websites
3. Student: Write paper, save, email (all automated)
4. Developer: Analyze code, get suggestions

---

## ğŸ“‚ Key Project Files

**Core:**
- `src/lmapp/` - Main package
- `src/lmapp/rag/` - RAG system (2,500 LOC) - ESSENTIAL
- `src/lmapp/workflows/` - Workflow engine (1,800 LOC) - ESSENTIAL
- `src/lmapp/plugins/` - Plugin system
- `src/lmapp/server/refactoring_service.py` - Code analysis
- `src/lmapp/backend/` - Ollama/llamafile backends

**Testing:**
- `tests/test_e2e_refactoring.py` - 18 integration tests
- `tests/test_performance_benchmark.py` - 14 performance tests
- `tests/test_uat_scenarios.py` - 9 UAT tests

**Documentation:**
- `MASTER_ROADMAP.md` - **PRIMARY roadmap** (source of truth)
- `README.md` - User-facing documentation
- `CHANGELOG.md` - Version history
- `GITHUB_SECRETS_SETUP.md` - PyPI/GitHub setup
- `VERSION_MANAGEMENT.md` - Release procedures

**Infrastructure:**
- `.github/workflows/build-test.yml` - CI/CD testing
- `.github/workflows/publish-release.yml` - PyPI publishing
- `pyproject.toml` - Project metadata

---

## ğŸ“ Session Logging & Automation

**Two-Tier Logging System:**

1. **Conversation Log** - 48-hour rolling interaction history
   - Track every agent conversation for continuity
   - Auto-prunes entries older than 48 hours
   - Search: `python3 ~/scripts/conversation_search.py <query>`
   - Add entry: `python3 ~/scripts/conversation_logger.py log "request" "response" "tools" "files"`

2. **Session Log** - Milestone tracking
   - Phase completions and major features
   - Append to `session_log.yaml` and `~/session_log_aggregate.yaml`
   - Keep last 3 backups (rotate_session_logs.sh)

**Performance Optimizations:**
- Lazy pruning (every 10 appends)
- Atomic writes with file locking
- In-memory caching for fast reads
- Truncation of long entries (500/1000 char limits)

---

## âš¡ Quick Reference

**Current Status:**
- Phase 1: âœ… COMPLETE (dev foundation, all core features)
- Phase 2A: ğŸš§ IN PROGRESS - Testing Complete (GUI core + E2E tests)
- Phase 2B: âœ… CORE COMPLETE - GUI Integration Done (Workflows + LLM + UI)
- Phase 3: ğŸ”œ FUTURE (VS Code extension, marketplace)

**Test Results:**
```
Phase 1 Backend Tests:    41/41  PASSED âœ…
Phase 2A GUI E2E Tests:   19/19  PASSED âœ…
Manual Test Checkpoints:  150+   READY âœ…
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
CI/CD: GitHub Actions (cross-platform)
Status: Ready for distribution packaging
```

**Version Tracking:**
- Development: v0.4.0 (Phase 2A GUI + 2B Workflows in progress)
- Production: v0.3.2 (released Dec 11, 2025)
- Next Release: v0.4.0-beta (GUI + workflows, Q1 2026)

**Assessment (CORRECTED Dec 15, 2025):**
- ğŸŸ¢ CORRECT DIRECTION (not over-engineered)
- 19k LOC appropriate for "AI everywhere" vision
- RAG/workflows are ESSENTIAL (not bloat)
- No refactoring needed
- Next: Add consumer layer (GUI, presets) in Phase 2

---

## ğŸ”§ Common Commands

```bash
# Development
lmapp chat                    # Interactive chat
lmapp serve                   # Start API server (port 8000)
pytest                        # Run all tests
pytest -v                     # Verbose test output
pytest --cov                  # Test coverage report

# Code Quality
black src/                    # Format code
flake8 src/                   # Lint check
mypy src/                     # Type check

# Project Info
lmapp --version              # Show version
lmapp --help                 # Show help
```

---

## âœ… Mandatory Compliance Rules

**Documentation:**
1. ONE master roadmap: MASTER_ROADMAP.md (INTEGRATED_ROADMAP.md archived)
2. Check for existing master doc BEFORE creating new ones
3. Delete redundant documentation immediately
4. Link to existing docs instead of duplicating content

**Testing:**
1. All new features require test coverage
2. Phase 2C baseline: 41 tests, 100% pass rate
3. Performance targets: <500ms analysis
4. UAT scenarios validate real-world use cases

**Releases:**
1. Tag format: vX.Y.Z (semantic versioning)
2. CI/CD: test â†’ build â†’ PyPI publish â†’ GitHub release
3. Always update CHANGELOG.md before tagging
4. All tests must pass before release

**Session Logs:**
1. Update both session_log.yaml and session_log_aggregate.yaml
2. Rotate logs (keep only last 3)
3. Mandatory for all phase completions and major features

---

## ğŸ“– For More Information

- **Master Roadmap:** See `MASTER_ROADMAP.md` (source of truth)
- **QA Results:** See `tests/PHASE_2C_QA_REPORT.md`
- **Setup & Secrets:** See `GITHUB_SECRETS_SETUP.md`
- **Release Guide:** See `VERSION_MANAGEMENT.md`
- **Global Standards:** See `.github/copilot-instructions.md`

**Re-Launch Strategy:** Option A (Soft Transition)
- Keep current versions (v0.3.2 on PyPI/GitHub)
- Release Phase 2 as v0.4.0+ updates
- Marketing: "Now with GUI!"
- Both CLI and GUI side-by-side

---

## ğŸ—‚ï¸ Workspace Communication System

**Purpose:** Real-time activity tracking and session-resilient communication for lmapp development.

### Active Files (Check these first)
- **PROJECT_ACTIVITY.md:** Real-time lmapp development status (NOW section, recent actions)
- **../WORKSPACE_CHAT_ACTIVE.md:** Last 4 Q&A exchanges (workspace-wide)
- **../WORKSPACE_MASTER_SUMMARY.md:** Last 4 milestone summaries

### Records Files (Rolling backup - reference when needed)
- **../WORKSPACE_CHAT_RECORDS.md:** Older exchanges (7-day cap)
- **../WORKSPACE_SUMMARY_RECORDS.md:** Older summaries (14-day cap)

### Key Scripts (~/scripts/)
- **rotate_chat.sh:** Auto-rotate chat (keeps last 4 in ACTIVE)
- **rotate_master_summary.sh:** Auto-rotate summaries (keeps last 4)
- **session_recovery.sh:** Show workspace state after context loss
- **workspace_auto_rotate.sh:** Master automation (integrates all rotation)

### Usage Guidelines

**âš ï¸ CRITICAL PROACTIVE CHECK (MANDATORY):**
- **ALWAYS check WORKSPACE_CHAT_ACTIVE.md FIRST** before any action
- Check **even without "chat" command** - proactive check required
- Check on **EVERY user interaction** (not just when user says "chat")
- Check **preemptively if context lost** or session starts
- **Answer user questions BEFORE** proceeding with any other work

**Standard Commands:**
1. **Say "chat"** to check WORKSPACE_CHAT_ACTIVE.md for questions
2. **Say "activity"** to check PROJECT_ACTIVITY.md for current work
3. **Update NOW section** in PROJECT_ACTIVITY.md with timestamps for each action
4. **Session recovery:** Run `bash ~/scripts/session_recovery.sh` if context lost

### Auto-Rotation Logic
- When ACTIVE has 5 entries â†’ delete oldest, keep 4
- RECORDS append automatically after every response
- Chat RECORDS: 7-day retention cap
- Summary RECORDS: 14-day retention cap

**See:** `~/.github/copilot-instructions.md` Section 5 for full documentation

**System Status:** âœ… TESTED & VERIFIED (Phase 0.5 complete - all 7 tests passed)

---

**Last Updated:** December 16, 2025 00:09
**Status:** Phase 1 Complete âœ… | Phase 2A GUI 90% | Phase 2B Workflows 95%
**Next Action:** Integrate cache.py + Complete Phase 2A GUI
